name: Discord - Notify on push

on:
  push:
    branches:
      - '**'          # k√∂r p√• ALLA branches
  workflow_dispatch:  # s√• du kan starta den manuellt fr√•n GitHub

jobs:
  notify-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Visa info om k√∂rningen
        run: |
          echo "Repo: ${GITHUB_REPOSITORY}"
          echo "Branch: ${GITHUB_REF_NAME}"
          echo "Actor: ${GITHUB_ACTOR}"

      - name: Kontrollera att webhook-secret finns
        env:
          DISCORD_WEBHOOK_URL: ${ secrets.DISCORD_WEBHOOK }
        run: |
          if [ -z "$DISCORD_WEBHOOK" ]; then
            echo "‚ùå Secret DISCORD_WEBHOOK_URL saknas eller √§r tomt."
            exit 1
          fi

          echo "‚úÖ Secret DISCORD_WEBHOOK_URL finns och √§r inte tomt."

      - name: Skicka meddelande till Discord
        env:
          DISCORD_WEBHOOK_URL: ${ secrets.DISCORD_WEBHOOK }
        run: |
          MESSAGE="‚úÖ Alan √§r klar! üöÄ Ny push till ${GITHUB_REPOSITORY} p√• branch ${GITHUB_REF_NAME} av ${GITHUB_ACTOR}"
          echo "Skickar detta meddelande:"
          echo "${MESSAGE}"

          curl -v -H "Content-Type: application/json" \
               -d "{\"content\": \"${MESSAGE}\"}" \
               "${DISCORD_WEBHOOK}"
